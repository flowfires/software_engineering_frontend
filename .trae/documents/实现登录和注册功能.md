# 实现登录和注册功能

## 1. 创建用户数据库模型

* 创建 `app/models/user.py` 文件

* 定义 `User` 类，继承自 `BaseModel`

* 添加字段：用户名、邮箱、密码哈希、角色等

* 添加必要的索引和约束

## 2. 创建用户相关的Pydantic模型

* 创建 `app/schema` 目录

* 创建 `app/schema/user.py` 文件

* 定义 `UserCreate` 模型：用于注册请求

* 定义 `UserLogin` 模型：用于登录请求

* 定义 `UserResponse` 模型：用于返回用户信息

* 定义 `Token` 模型：用于返回JWT令牌

## 3. 实现注册功能

* 修改 `app/api/v1/auth.py` 中的 `register` 函数

* 验证请求数据

* 检查用户名和邮箱是否已存在

* 使用 `get_password_hash` 哈希密码

* 创建用户并保存到数据库

* 返回成功响应

## 4. 实现登录功能

* 修改 `app/api/v1/auth.py` 中的 `login` 函数

* 验证请求数据

* 根据用户名或邮箱查找用户

* 使用 `verify_password` 验证密码

* 使用 `create_access_token` 生成JWT令牌

* 返回令牌

## 5. 完善get\_current\_user函数

* 修改 `app/core/security.py` 中的 `get_current_user` 函数

* 从数据库中获取用户

* 验证用户是否存在

* 返回用户对象

## 6. 运行数据库迁移

* 初始化数据库

* 创建用户表

## 不必测试，跳过测试这一部分

